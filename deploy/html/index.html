{%- from "macros/utils.html" import getImageSrc -%}
{%- set appconf = getEntry("appconf") -%}

{%- if not skel -%}
	{%- set skel = appconf -%}
{%- endif -%}

{%- if not title -%}
	{%- set TITLE = appconf["site_title"] + " - " + appconf["site_slogan"] -%}
{%- else -%}
	{%- set TITLE = title + " - " + appconf["site_title"] -%}
{%- endif -%}

{%- set cuser = getCurrentUser() -%}

{% macro menuEntry(page, class="") %}
	{% if page["static"]|string != "" %}
		<a href="/s/{{ page["static"]|replace(".html", "") }}" class="{{ class }}">{{ page["name"] }}</a>
	{% else %}
		<a href="/{{ page["alias"] if page["alias"] != "index" }}" class="{{ class }}">{{ page["name"] }}</a>
	{% endif %}
{% endmacro %}

<!DOCTYPE html>
<html xml:lang="de" lang="de">
<head>
	<title>{{ TITLE }}</title>

	<!-- meta -->
	<meta charset="UTF-8">

	<meta name="author" content="{{ appconf["site_name"] }}">
	<meta name="generator" content="www.viur.dev">
	<meta name="description" content="{{ skel["seo_description"] or appconf["seo_description"] }}"/>
	<meta name="keywords" content="{{ skel["seo_keywords"] or appconf["seo_keywords"] }}"/>
	<meta name="page-topic" content="{{ skel["title"] or skel["name"] or title }}">
	<meta name="robots" content="index, follow">
	<meta name="language" content="de-DE">

	{% if goto %}
		<meta http-equiv="refresh" content="3; URL={{ goto }}">
	{% endif %}

	<meta property="og:title"
		  content="{{ skel["seo_title"] or appconf["seo_title"] or skel["title"] or skel["name"] or title }}"/>
	<meta property="og:description" content="{{ skel["seo_description"] or appconf["seo_description"] }}"/>
	<meta property="og:image"
		  content="{{ getImageSrc(skel["seo_image"] or appconf["seo_image"] or (getHostUrl() + "/static/img/logo.svg")) }}"/>
	<meta property="og:url" content="{{ getHostUrl() }}"/>
	<meta property="og:type" content="website"/>
	<meta property="og:locale" content="de_DE"/>

	<meta http-equiv="x-ua-compatible" content="IE=edge">

	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,shrink-to-fit=no">
	<meta name="theme-color" content="#fff">

	<!-- Favicon -->
	<link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.ico">
	<link rel="shortcut icon" type="image/png" href="/static/img/favicon.png">

	<!-- CSS -->
	<link rel="stylesheet" href="/static/css/style.css">

	<!-- Fonts -->
	<link rel="preload" href="/static/webfonts/Oswald-Light.ttf" as="font" crossorigin="anonymous"/>
	<link rel="preload" href="/static/webfonts/Oswald-Regular.ttf" as="font" crossorigin="anonymous"/>
	<link rel="preload" href="/static/webfonts/Oswald-Medium.ttf" as="font" crossorigin="anonymous"/>

	<!-- JS -->
	<script src="/static/js/jquery.min.js"></script>
	<script src="/static/js/app.js"></script>

	{% block additionalHeader %}
	{% endblock %}

</head>

<body {{ ONLOAD }}>
<header class="header">
	<a href="{{ "/" if not cuser else "/user/view" }}" class="logo">
		<img src="/static/img/logo.svg" class="logo-img">
	</a>

	<a class="burger burgertox js_burger">
		<span>Main Menu</span>
	</a>

	<div class="main-menu">
		{% for page in getList("page", menu="main") %}
			{{ menuEntry(page, "mM-item") }}
		{% endfor %}
	</div>
</header>

<main class="main">
	{% block body %}
		{% for section in getList("section", **{"page.dest.key": skel["key"]}) %}
			{% if section["mode"] == "teaser" %}
				<div class="wrap wrap--image wrap--fullHeight"
					 style="background-image: url({{ getImageSrc(section["image"], 1600) }})">
					<span>
						<h1 class="wrap--image-headline">{{ section["title"] }}</h1>
					</span>
				</div>
			{% elif section["mode"] == "text" %}
				<div class="wrap">
					<div class="content">
						{% if section["image"] %}
							<div class="v-card">
								<div class="v-card-img"
									 style="background-image: url({{ getImageSrc(section["image"], 600) }})"></div>
								<div class="v-card-txt">
									<h2>{{ section["title"] }}</h2>
									{{ section["content"] }}
								</div>
							</div>
						{% else %}
							<h2>{{ section["title"] }}</h2>
							{{ section["content"] }}
						{% endif %}
					</div>
				</div>
			{% else %}
				<strong>Type {{ section["mode"]|string }} is not supported</strong>
			{% endif %}
		{% endfor %}
		<!--
		<a id="kontakt" name="kontakt"></a>

		<div class="sv-image">
			<iframe src="//www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4183.531275042748!2d7.639928952913273!3d51.42982878202839!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47b93fe3748c9391%3A0x78d346720835b383!2sFlugplatz%20Rheinermark!5e0!3m2!1sde!2sde!4v1573836286552!5m2!1sde!2sde" frameborder="0" style="width:100%;height:100%;border:0" allowfullscreen=""></iframe>
		</div>
		-->
	{% endblock %}
</main>

<footer class="footer">
	<div class="wrap">
		<div class="content">
			<div class="grid grid--3">
				<div class="footer-column">
					{% for page in getList("page", menu="main") %}
						<span>{{ menuEntry(page) }}</span>
					{% endfor %}
				</div>
				<div class="footer-column">
					{% for page in getList("page", menu="foot") %}
						<span>{{ menuEntry(page) }}</span>
					{% endfor %}
				</div>
				<div class="footer-column">
					<em>&copy; {{ dateTime().now().strftime("%Y") }}
						{{ appconf["site_name"] }}</em>
				</div>
			</div>
		</div>
	</div>
</footer>

<!-- CookieConsent Popup -->
<div id="cookieConsent">
	Diese Webseite verwendet Cookies zum Zwecke der Datensicherheit.
	Eine weitere Auswertung dieser Daten findet nicht statt!

	<a href="/privacy" target="_blank">Weitere Informationen</a>
	<a id="cookieConsentOK">Verstanden!</a>
</div>
<!-- /CookieConsent Popup -->

</body>
</html>

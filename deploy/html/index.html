{%- from "macros/utils.html" import getImageSrc -%}
{%- set appconf = getEntry("appconf") -%}

{%- if not skel -%}
	{%- set skel = appconf -%}
{%- endif -%}

{%- if not title -%}
	{%- set TITLE = appconf["site_title"] + " - " + appconf["site_slogan"] -%}
{%- else -%}
	{%- set TITLE = title + " - " + appconf["site_title"] -%}
{%- endif -%}

{%- set cuser = getCurrentUser() -%}

{% macro menuEntry(page, class="") %}
	{% if page["static"]|string != "" %}
		<a href="/s/{{ page["static"]|replace(".html", "") }}" class="{{ class }}">{{ page["name"] }}</a>
	{% else %}
		<a href="/{{ page["alias"] if page["alias"] != "index" }}" class="{{ class }}">{{ page["name"] }}</a>
	{% endif %}
{% endmacro %}

<!DOCTYPE html>
<html xml:lang="de" lang="de">
<head>
	<title>{{ TITLE }}</title>

	<!-- meta -->
	<meta charset="UTF-8">

	<meta name="author" content="{{ appconf["site_name"] }}">
	<meta name="generator" content="www.viur.dev">
	<meta name="description" content="{{ skel["seo_description"] or appconf["seo_description"] }}"/>
	<meta name="keywords" content="{{ skel["seo_keywords"] or appconf["seo_keywords"] }}"/>
	<meta name="page-topic" content="{{ skel["title"] or skel["name"] or title }}">
	<meta name="robots" content="index, follow">
	<meta name="language" content="de-DE">

	{% if goto %}
		<meta http-equiv="refresh" content="3; URL={{ goto }}">
	{% endif %}

	<meta property="og:title"
		  content="{{ skel["seo_title"] or appconf["seo_title"] or skel["title"] or skel["name"] or title }}"/>
	<meta property="og:description" content="{{ skel["seo_description"] or appconf["seo_description"] }}"/>
	<meta property="og:image"
		  content="{{ getImageSrc(skel["seo_image"] or appconf["seo_image"] or (getHostUrl() + "/static/img/logo.svg")) }}"/>
	<meta property="og:url" content="{{ getHostUrl() }}"/>
	<meta property="og:type" content="website"/>
	<meta property="og:locale" content="de_DE"/>

	<meta http-equiv="x-ua-compatible" content="IE=edge">

	<!-- Mobile Specific Metas -->
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,shrink-to-fit=no">
	<meta name="theme-color" content="#fff">

	<!-- Favicon -->
	<link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.ico">
	<link rel="shortcut icon" type="image/png" href="/static/img/favicon.png">

	<!-- CSS -->
	<link rel="stylesheet" href="/static/css/lightbox.css">
	<link rel="stylesheet" href="/static/css/style.css">

	<!-- Fonts -->
	<link rel="preload" href="/static/webfonts/Oswald-Light.ttf" as="font" crossorigin="anonymous"/>
	<link rel="preload" href="/static/webfonts/Oswald-Regular.ttf" as="font" crossorigin="anonymous"/>
	<link rel="preload" href="/static/webfonts/Oswald-Medium.ttf" as="font" crossorigin="anonymous"/>

	<!-- JS -->
	<script src="/static/js/jquery.min.js"></script>
	<script src="/static/js/lightbox.js"></script>
	<script src="/static/js/app.js"></script>

	{% block additionalHeader %}
	{% endblock %}

</head>

<body {{ ONLOAD }}>

{% block socialmedia %}
<div class="social-media-wrap social-media-absolute js-social-media-absolute">
	<a href="https://www.instagram.com/lsg_ravensburg/" target="_blank" class="social-media-item">
		<img src="/static/img/instagram-icon.svg">
	</a>
	<a href="https://de-de.facebook.com/pages/category/Nonprofit-Organization/102618055353147/" class="social-media-item">
		<img src="/static/img/facebook-icon.svg">
	</a>
	<!--
	<a href="https://www.youtube.com/channel/UCh1ujTWw8rlJkjWOY6WuvcQ" target="_blank" class="social-media-item">
		<img src="/static/img/youtube-icon.svg">
	</a>
	-->
	<a href="/kontakt" class="social-media-item">
		<img src="/static/icons/newsletter.svg">
	</a>
</div>
{% endblock %}

<header class="header">
	<a href="{{ "/" if not cuser else "/user/view" }}" class="logo">
		<img src="/static/img/logo.svg" class="logo-img">
	</a>

	<a class="burger burgertox js_burger">
		<span>Main Menu</span>
	</a>

	<div class="main-menu">
		{% for page in getList("page", menu="main") %}
			{{ menuEntry(page, "main-menu-item") }}
		{% endfor %}
	</div>
</header>

<main class="main">
	{% block body %}
		{% macro titleIfAvailable(title) %}
			{% if title %}
				<div class="wrap wrap--dark">
					<div class="content">
						<h2>{{ title }}</h2>
					</div>
				</div>
			{% endif %}
		{% endmacro %}

		{% for section in getList("section", **{"page.dest.key": skel["key"]}) %}
			{% if section["mode"] == "teaser" %}
				{% if section["image"] or section["external_image"] %}
					<div class="wrap wrap--image wrap--fullHeight {{ "is-external" if not section["image"] and section["external_image"] }}"
					 	style="background-image: url({{ getImageSrc(section["image"], 1600) if section["image"] else section["external_image"] }})">
				{% else %}
					<div class="wrap wrap--dark">
				{% endif %}
					<span>
						<h1 class="wrap--image-headline">{{ section["title"] }}</h1>
					</span>
				</div>

			{% elif section["mode"] == "text" %}
				<div class="wrap">
					<div class="content">
						{% if (section["image"] or section["external_image"]) and section["image_position"]|string %}
							<div class="v-card v-card--square">
								{% if section["image_position"]|string == "left" %}
									<div class="v-card-img {{ "is-external" if not section["image"] and section["external_image"] }}"
										 style="background-image: url({{ getImageSrc(section["image"], 600) if section["image"] else section["external_image"] }})"></div>
								{% endif %}
								<div class="v-card-txt">
									<h2>{{ section["title"] }}</h2>
									{{ section["content"] }}
								</div>
								{% if section["image_position"]|string == "right" %}
									<div class="v-card-img {{ "is-external" if not section["image"] and section["external_image"] }}"
										 style="background-image: url({{ getImageSrc(section["image"], 600) if section["image"] else section["external_image"] }})"></div>
								{% endif %}
							</div>
						{% else %}
							<h2>{{ section["title"] }}</h2>
							{{ section["content"] }}
						{% endif %}
					</div>
				</div>

			{% elif section["mode"] == "news" %}
				{{ titleIfAvailable(section["title"]) }}

				<div class="wrap">
					<div class="content">
						{% set entries = getList("news", amount=4) %}
						<div class="grid grid--3">
							{% for entry in entries[:3] %}
								<a class="card" href="/news/view/{{ entry["key"]|shortKey }}">
									<div class="card-img" style="background-image: url({{ getImageSrc(entry["teaser"], 600) }})"></div>
									<div class="card-txt">
										<h3>{{ entry["title"] }}</h3>
										<p>Gepostet am {{ entry["date"].strftime("%d.%m.%Y") }}</p>
										{{ entry["content"] }}
									</div>
								</a>
							{% endfor %}
						</div>

						{% if entries|length > 3 %}
							<a class="btn btn--more" href="/news/list?amount=99">Alle anzeigen</a>
						{% endif %}
					</div>
				</div>

			{% elif section["mode"] == "iframe" %}
				{{ titleIfAvailable(section["title"]) }}

				{% if section["url"] %}
					<div class="wrap">
						<iframe src="{{ section["url"] }}" frameborder="0" allowfullscreen=""></iframe>
					</div>
				{% endif %}

    		{% elif section["mode"] == "youtube" %}
				{{ titleIfAvailable(section["title"]) }}

				<div class="wrap">
					<div class="content">
						<iframe src="https://www.youtube.com/embed/{{ section["youtube"] }}" title="{{ section["title"] }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
					</div>
				</div>

			{% elif section["mode"] == "formmailer" %}
				{{ titleIfAvailable(section["title"]) }}

				<div class="wrap">
					<div class="content">
						{{ section["content"] }}
						{{ betterExecRequest("contact/add", style="embed") }}
					</div>
				</div>

			{% else %}
				<strong>Type {{ section["mode"]|string }} is not supported</strong>
			{% endif %}
		{% endfor %}
	{% endblock %}
</main>

<footer class="footer">
	<div class="wrap">
		<div class="content">
			<div class="grid grid--3">
				<div class="footer-column">
					{% for page in getList("page", menu="main") %}
						<span>{{ menuEntry(page) }}</span>
					{% endfor %}
				</div>
				<div class="footer-column">
					{% for page in getList("page", menu="foot") %}
						<span>{{ menuEntry(page) }}</span>
					{% endfor %}
				</div>
				<div class="footer-column">
					<em>&copy; {{ dateTime().now().strftime("%Y") }}
						{{ appconf["legal_name"] }}</em>
				</div>
			</div>
		</div>
	</div>
</footer>

<!-- CookieConsent Popup -->
<div id="cookieConsent">
	Diese Webseite verwendet Cookies zum Zwecke der Datensicherheit.
	Eine weitere Auswertung dieser Daten findet nicht statt!

	<a href="/privacy" target="_blank">Weitere Informationen</a>
	<a id="cookieConsentOK">Einverstanden</a>
</div>
<!-- /CookieConsent Popup -->

</body>
</html>
